# Individualdata-plugin â€“ æ’ä»¶å¼€å‘æŒ‡å—

ä¸ªä½“æ•°æ®æ’ä»¶åº“ Â· æ’ä»¶å¼€å‘æ–‡æ¡£

## ç›®å½•

* [1. æ’ä»¶ç³»ç»Ÿæ¦‚è§ˆ](#1-æ’ä»¶ç³»ç»Ÿæ¦‚è§ˆ)
* [2. æ’ä»¶å…ƒæ•°æ®](#2-æ’ä»¶å…ƒæ•°æ®)
* [3. æ’ä»¶å¼€å‘æµç¨‹](#3-æ’ä»¶å¼€å‘æµç¨‹)
* [4. å®æˆ˜ç¤ºä¾‹](#4-å®æˆ˜ç¤ºä¾‹)

  * [4.1 å…¨å±€å¤–è§‚æ’ä»¶ï¼ˆThemeï¼‰](#41-å…¨å±€å¤–è§‚æ’ä»¶theme)
  * [4.2 å•é¡µé¢å¤–è§‚æ’ä»¶ï¼ˆComponent æ ·å¼å®šåˆ¶ï¼‰](#42-å•é¡µé¢å¤–è§‚æ’ä»¶component-æ ·å¼å®šåˆ¶)
  * [4.3 æ–°é¡µé¢ + API æ’ä»¶ï¼ˆåŠ¨æ€è·¯ç”±ä¸æ•°æ®å†™å…¥ï¼‰](#43-æ–°é¡µé¢--api-æ’ä»¶åŠ¨æ€è·¯ç”±ä¸æ•°æ®å†™å…¥)
* [5. å®‰å…¨ä¸æ³¨æ„äº‹é¡¹](#5-å®‰å…¨ä¸æ³¨æ„äº‹é¡¹)
* [6. API çº¦å®šä¸€è§ˆ](#6-api-çº¦å®šä¸€è§ˆ)

---

## 1. æ’ä»¶ç³»ç»Ÿæ¦‚è§ˆ

* æ‰€æœ‰æ’ä»¶æ•°æ®å­˜æ”¾äº **MongoDB** çš„ `plugins` é›†åˆï¼Œå¹¶é€šè¿‡ **`/api/plugins`** ç»Ÿä¸€ç®¡ç†**å®‰è£… / å¯ç”¨ / åœç”¨**ã€‚
* åº”ç”¨å¯åŠ¨æ—¶ï¼Œ**`PluginManager`** ä¼šä» **`/api/plugin-gateway`** æ‹‰å–æ‰€æœ‰**å·²æ¿€æ´»æ’ä»¶**å¹¶æŒ‰é¡ºåºæ‰§è¡Œï¼š

  * å°† `code.css` æ³¨å…¥åˆ° **`<head>`**ï¼Œæ”¹å˜å…¨å±€æ ·å¼ï¼›
  * åœ¨å—é™æ²™ç®±ä¸­æ‰§è¡Œ `code.js`ï¼ˆæ²™ç®±ä¸­æä¾› `app`ã€`axios` ç­‰å¯¹è±¡ï¼‰ã€‚

---

## 2. æ’ä»¶å…ƒæ•°æ®

ä¸‹è¡¨ä¸ºæ ¸å¿ƒå­—æ®µï¼ˆå®Œæ•´ç»“æ„å¯å‚è€ƒ `sample-plugin.json`ï¼‰ï¼š

| å­—æ®µ            | ç±»å‹         |  å¿…å¡« | è¯´æ˜                                          |
| ------------- | ---------- | :-: | ------------------------------------------- |
| `id`          | `string`   |  âœ”ï¸ | æ’ä»¶å”¯ä¸€æ ‡è¯†ï¼ˆéœ€å…¨å±€å”¯ä¸€ï¼‰                               |
| `name`        | `string`   |  âœ”ï¸ | æ’ä»¶åç§°                                        |
| `version`     | `string`   |     | ç‰ˆæœ¬å·ï¼Œè¯­ä¹‰åŒ–æ¨è                                   |
| `type`        | `string`   |  âœ”ï¸ | æ’ä»¶ç±»å‹ï¼ˆå¦‚ `theme` / `component` / `page` ç­‰ï¼‰    |
| `code.js`     | `string`   |     | å°†è¦åœ¨æ²™ç®±å†…æ‰§è¡Œçš„è„šæœ¬                                 |
| `code.css`    | `string`   |     | å°†æ³¨å…¥ `<head>` çš„æ ·å¼                            |
| `permissions` | `string[]` |     | éœ€è¦çš„æƒé™ï¼ˆå¦‚ `database.insert`ã€`database.query`ï¼‰ |
| `status`      | `string`   |     | æ’ä»¶çŠ¶æ€ï¼ˆå¦‚ `active` / `inactive`ï¼‰               |

---

## 3. æ’ä»¶å¼€å‘æµç¨‹

1. **ç¼–å†™æ’ä»¶ JSON**ï¼šéµå¾ªä¸Šè¿°å­—æ®µç»“æ„ï¼Œç¡®ä¿ `id` å”¯ä¸€ã€‚
2. **ä¸Šä¼ **ï¼šç®¡ç†å‘˜åœ¨ **ç³»ç»Ÿ â†’ æ’ä»¶ç®¡ç†** å¼¹çª—ä¸­é€‰æ‹© JSONï¼Œç‚¹å‡»â€œä¸Šä¼ æ’ä»¶â€å®Œæˆå­˜å‚¨ã€‚
3. **å¯ç”¨/åœç”¨**ï¼šåœ¨åŒä¸€åˆ—è¡¨ä¸­åˆ‡æ¢å¼€å…³ï¼›å¯ç”¨å `PluginManager` ä¼š**é‡æ–°åŠ è½½**å·²æ¿€æ´»æ’ä»¶ã€‚
4. **è¿è¡Œ**ï¼š

   * æ¿€æ´»åï¼ŒCSS/JS **ç«‹å³ç”Ÿæ•ˆ**ï¼›
   * æ¶‰åŠæ•°æ®åº“ç­‰æ•æ„Ÿæ“ä½œæ—¶ï¼Œé€šè¿‡ **`/api/plugin-gateway`** è°ƒç”¨ï¼Œéœ€**æºå¸¦ç›¸åº”æƒé™**ã€‚

> ğŸ’¡ æç¤ºï¼šæ ·å¼è¦†ç›–å»ºè®®**å°½é‡ä½¿ç”¨æ›´ç²¾å‡†çš„é€‰æ‹©å™¨**ï¼Œä»¥å…å½±å“åˆ°éç›®æ ‡é¡µé¢æˆ–ç»„ä»¶ã€‚

---

## 4. å®æˆ˜ç¤ºä¾‹

### 4.1 å…¨å±€å¤–è§‚æ’ä»¶ï¼ˆThemeï¼‰

```json
{
  "id": "glass-theme",
  "name": "æ¶²æ€ç»ç’ƒä¸»é¢˜",
  "version": "1.0.0",
  "type": "theme",
  "code": {
    "css": "body { backdrop-filter: blur(10px); background: rgba(255,255,255,0.2); }"
  },
  "permissions": []
}
```

å¯ç”¨åï¼Œ`PluginManager` ä¼šå°† `code.css` æ³¨å…¥é¡µé¢ï¼Œå®ç°å…¨å±€â€œç»ç’ƒåŒ–â€æ•ˆæœã€‚

---

### 4.2 å•é¡µé¢å¤–è§‚æ’ä»¶ï¼ˆComponent æ ·å¼å®šåˆ¶ï¼‰

```json
{
  "id": "home-dark-card",
  "name": "é¦–é¡µå¡ç‰‡æš—åŒ–",
  "type": "component",
  "code": {
    "css": "#app .home-page .v-card { background-color: #1e1e1e !important; }"
  }
}
```

åªéœ€é’ˆå¯¹**ç‰¹å®šé¡µé¢æ ¹èŠ‚ç‚¹**æ·»åŠ é€‰æ‹©å™¨ï¼Œå³å¯å°†å½±å“èŒƒå›´é™åˆ¶åœ¨è¯¥é¡µé¢ã€‚

---

### 4.3 æ–°é¡µé¢ + API æ’ä»¶ï¼ˆåŠ¨æ€è·¯ç”±ä¸æ•°æ®å†™å…¥ï¼‰

**å¯è¯»ç‰ˆï¼ˆæ¼”ç¤ºæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä¾¿äºç†è§£ï¼‰ï¼š**

```json
{
  "id": "notes-page",
  "name": "ç¬”è®°é¡µé¢",
  "type": "page",
  "permissions": ["database.insert", "database.query"],
  "code": {
    "js": "`const Notes = {\
      \n  template: '<div><h1>ç¬”è®°</h1><input v-model=\\\"text\\\"/><button @click=\\\"save\\\">ä¿å­˜</button></div>',\
      \n  data(){ return { text: '' } },\
      \n  methods:{\
      \n    async save(){\
      \n      await axios.post('/api/plugin-gateway', {\
      \n        pluginId: 'notes-page',\
      \n        operation: 'database.insert',\
      \n        data: { collection: 'notes', document: { text: this.text } }\
      \n      })\
      \n    }\
      \n  }\
      \n};\
      \napp.component('Notes', Notes);\
      \napp.config.globalProperties.$router.addRoute({ path: '/notes', component: Notes });`"
  }
}
```

**ä¸¥æ ¼ JSON ç‰ˆï¼ˆå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰ï¼š**

```json
{
  "id": "notes-page",
  "name": "ç¬”è®°é¡µé¢",
  "type": "page",
  "permissions": ["database.insert", "database.query"],
  "code": {
    "js": "const Notes = {\\n  template: '<div><h1>ç¬”è®°</h1><input v-model=\\\"text\\\"/><button @click=\\\"save\\\">ä¿å­˜</button></div>',\\n  data(){ return { text: '' } },\\n  methods:{\\n    async save(){\\n      await axios.post('/api/plugin-gateway', {\\n        pluginId: 'notes-page',\\n        operation: 'database.insert',\\n        data: { collection: 'notes', document: { text: this.text } }\\n      })\\n    }\\n  }\\n};\\napp.component('Notes', Notes);\\napp.config.globalProperties.$router.addRoute({ path: '/notes', component: Notes });"
  }
}
```

> âœ… æ•ˆæœï¼šæ’ä»¶åŠ è½½æ—¶**åŠ¨æ€æ³¨å†Œç»„ä»¶ä¸è·¯ç”±**ï¼Œæ–°å¢ `/notes` é¡µé¢ï¼›é€šè¿‡ `pluginId + operation` è°ƒç”¨ `/api/plugin-gateway` å†™å…¥æˆ–æŸ¥è¯¢æ•°æ®ï¼Œåç«¯ä¼šæ ¹æ® `permissions` è¿›è¡Œæƒé™æ ¡éªŒã€‚

---

## 5. å®‰å…¨ä¸æ³¨æ„äº‹é¡¹

* å½“å‰æ²™ç®±ä½¿ç”¨ `new Function` + `with` çš„æ–¹å¼ï¼Œ**éš”ç¦»èƒ½åŠ›æœ‰é™**ï¼›è¯·é¿å…å¼•å…¥å±é™©è°ƒç”¨ä¸å…¨å±€å‰¯ä½œç”¨ã€‚
* éœ€è¦è®¿é—®æ•°æ®åº“æˆ–å…¶ä»–æ•æ„Ÿèƒ½åŠ›çš„æ’ä»¶ï¼ŒåŠ¡å¿…åœ¨ `permissions` ä¸­**æ˜¾å¼å£°æ˜**ï¼Œå¹¶é€šè¿‡åå°å®¡æ ¸å†æ¿€æ´»ã€‚
* æ’ä»¶ä¸Šä¼ ä¸å¯åœå‡éœ€**ç®¡ç†å‘˜ç™»å½•**å¹¶æºå¸¦ **JWT Token**ã€‚
* æ›´å¤æ‚çš„æ‰©å±•ï¼ˆä¸»é¢˜ / åŠŸèƒ½åº“ / UI ç»„ä»¶ç­‰ï¼‰å¯åœ¨ `code.js` ä¸­ä½¿ç”¨ `app` ä¸å…¨å±€ Routerï¼Œæˆ–åœ¨ `code.css` ä¸­è¿›è¡Œæ ·å¼è¦†ç›–ã€‚

> ğŸ”’ æœ€ä½³å®è·µï¼š
>
> * é»˜è®¤æœ€å°æƒé™ï¼ˆ**Least Privilege**ï¼‰ï¼›
> * å…³é”®æ“ä½œç»ç”±åç«¯ç½‘å…³ç»Ÿä¸€æ‰§è¡Œä¸šåŠ¡æ ¡éªŒï¼›
> * å¯¹ç¬¬ä¸‰æ–¹ä¾èµ–è¿›è¡Œæ¥æºä¸å®Œæ•´æ€§æ ¸éªŒã€‚

---

## 6. API çº¦å®šä¸€è§ˆ

* **`/api/plugins`**ï¼šæ’ä»¶çš„**åˆ›å»º / æŸ¥è¯¢ / å¯åœ**ç®¡ç†æ¥å£ï¼ˆéœ€ç®¡ç†å‘˜ï¼‰ã€‚
* **`/api/plugin-gateway`**ï¼šæ’ä»¶ä¾§å‘èµ·çš„**å—æ§èƒ½åŠ›è°ƒç”¨**ä¸**æ•°æ®è®¿é—®**ç»Ÿä¸€ç½‘å…³ï¼ˆåç«¯æŒ‰ `pluginId` + `operation` ä¸ `permissions` è¿›è¡Œæˆæƒä¸å®¡è®¡ï¼‰ã€‚
